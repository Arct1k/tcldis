<html>
<head>
    <script src="/tcldis/web/react-0.11.2.min.js"></script>
    <script src="/tcldis/web/JSXTransformer-0.11.2.js"></script>
    <script src="/tcldis/web/script.js" type="text/jsx"></script>
    <link href="/tcldis/web/style.css" rel="stylesheet" type="text/css">
    <script src="/tcldis.js"></script>
</head>
<body>
<div id="tcldis"></div>
<pre style="display: none;" id="initial_code">set x 5
puts 1
if {$x &lt; 15} {
    puts 1
}
puts 2
foreach {a b} [list 1 2 3 4] {
    puts [expr {$a + $b}]
}
puts 3
catch {my_buggy_proc} {
    puts "the proc failed"
}
puts 4
</pre>
<script type="text/jsx">
/** @jsx React.DOM */
'use strict';

empython.Initialize();
empython.Run('import tclpy; import tcldis; import base64; import json');
empython.Module.print = function (val) { window.decompiled = val; }

function getInitialCode(cb) {
    setTimeout(function () {
        cb(null, document.getElementById('initial_code').textContent);
    }, 0);
}

function getDecompileSteps(code, cb) {
    var proctcl = 'proc p {} {\n' + code + '\n}';
    empython.Run('tclpy.eval(base64.b64decode("' + btoa(proctcl) + '"))');
    empython.Run('steps, changes = tcldis.decompile_steps(tcldis.getbc(proc_name="p"));');
    empython.Run('print json.dumps({"steps": steps, "changes": changes}),');
    cb(null, JSON.parse(window.decompiled));
}

React.renderComponent(
    <TclDisUI />,
    document.getElementById('tcldis')
);
</script>
</body>
</html>
