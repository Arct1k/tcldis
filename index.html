<html>
<head>
    <meta charset="utf-8">
    <script src="react-0.12.2.min.js"></script>
    <link  href="style.css" rel="stylesheet" type="text/css">
    <script src="script.min.js"></script>
    <script async src="tcldis.js"></script>
</head>
<body>
<div id="tcldis"></div>
<pre style="display: none;" id="initial_code"># Example code to decompile
set x 5
puts 1
if {$x &lt; 15} {
    puts 1
}
puts 2
foreach {a b} [list 1 2 3 4] {
    puts [expr {$a + $b}]
}
puts 3
if {[catch {my_buggy_proc} err]} {
    puts $err
}
puts 4
</pre>
<script>
'use strict';

var decompile;
function init() {
    empython.Initialize();
    decompile = empython.Module.cwrap('emtcldis_decompile', 'string', ['string']);
    empython.Module.ccall('emtcldis_init', 'number', [], []);
}

function getInitialCode(cb) {
    var getCode = function () {
        cb(null, document.getElementById('initial_code').textContent);
    };
    if (window.empython === undefined) {
        // Try again later
        setTimeout(getInitialCode, 100, cb);
    } else {
        init();
        setTimeout(getCode, 0);
    }
}

function getDecompileSteps(code, cb) {
    // This setTimeout serves a dual purpose. It
    // 1. makes sure that the call to getDecompileSteps is async
    // 2. ensures that empython initialize and emtcldis_init above have run
    setTimeout(function () {
        var decompiled = JSON.parse(decompile('proc p {} {\n' + code + '\n}'));
        cb(null, {'steps': decompiled[0], 'changes': decompiled[1]});
    }, 0);
}

React.render(
    React.createElement(TclDisUI, null),
    document.getElementById('tcldis')
);
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37081910-6', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
